<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { corePlugins: { preflight: false } }</script>
    <link rel="stylesheet" href="/static/style.css">

    <link rel="stylesheet" type="text/css" href="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.25.0/maps/maps.css">
    <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.25.0/maps/maps-web.min.js"></script>
    <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.25.0/services/services-web.min.js"></script>
    <title>Camp Manager — Fair-Share</title>
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">Fair-Share V1</div>
        <div class="sidebar-section-title">Dashboard</div>
        <a href="{{ url_for('campBoard') }}" class="sidebar-link active">Dashboard</a>
        <div class="sidebar-section-title">Camps</div>
        <a href="/camp/add" class="sidebar-link">Add Camp</a>
        <a href="/camps" class="sidebar-link">View Camps</a>
        <div class="sidebar-section-title">Requests</div>
        <a href="{{ url_for('create_request') }}" class="sidebar-link">Create Request</a>
        <a href="{{ url_for('view_my_requests') }}" class="sidebar-link">My Requests</a>
        <div class="sidebar-section-title">Warehouse</div>
        <a href="{{ url_for('warehouse_view') }}" class="sidebar-link">View Inventory</a>
        <div class="sidebar-bottom">
            <a href="/logout" class="sidebar-link">Logout</a>
        </div>
    </div>

    <div id="notif-toasts" class="notif-toast-container"></div>

    <div class="page-content">
        <h2>Camp Manager Dashboard</h2>
        <p style="margin-bottom: 24px;">
           Manage your camps, review resources, and submit requests.
        </p>

        <div class="map-notif-row">
            <div class="card" style="flex:2; min-width: 300px;">
                <h4>Camp Locations</h4>
                <div id="map" style="height: 420px; width: 100%; border-radius: 8px; margin-top: 12px;"></div>
                <div class="legend" style="margin-top: 12px;">
                    <span class="legend-item"><span class="legend-dot" style="background:#e63946;"></span> High Urgency (≥0.7)</span>
                    <span class="legend-item"><span class="legend-dot" style="background:#f59e0b;"></span> Medium (0.4–0.7)</span>
                    <span class="legend-item"><span class="legend-dot" style="background:#10b981;"></span> Low (&lt;0.4)</span>
                </div>
            </div>
            
            <div class="card" style="flex:1; min-width: 260px; max-height: 500px; overflow-y: auto;">
                <h4>Recent Notifications</h4>
                <div id="notif-inline-box">
                    <p style="color: var(--text-muted); font-size: 0.9rem;">...</p>
                </div>
            </div>
        </div>

        <div style="margin-top: 24px; display: flex; gap: 12px; flex-wrap: wrap;">
            <a href="/camp/add" class="nday-predict-btn" style="text-decoration:none;">+ Add New Camp</a>
            <a href="{{ url_for('create_request') }}"  class="nday-predict-btn" style="text-decoration:none; background: var(--accent-blue);">+ Create Request</a>
        </div>
    </div>

    <script>
        // Initialize map
        var tomKey = "{{ tomtom_key|e }}";
        
        function initCampMap() {
            var map = tt.map({
                key: tomKey,
                container: 'map',
                center: [72.87, 19.07],
                zoom: 10,
                style: 'https://api.tomtom.com/style/2/custom/style/dG9tdG9tQEBATy9RajF0dTB5dUE5WmR3Oy9hdXFGZm1XUVl6MHdGUWhtOw==.json?key=' + tomKey
            });

            fetch('/api/camps')
                .then(r => r.json())
                .then(camps => {
                    camps.forEach(function(c) {
                        var color = c.urgency >= 0.7 ? '#e63946' : c.urgency >= 0.4 ? '#f59e0b' : '#10b981';
                        var el = document.createElement('div');
                        el.style.cssText = 'width:14px;height:14px;border-radius:50%;border:2px solid #fff;background:' + color + ';box-shadow:0 0 6px ' + color + '80;';
                        
                        var popup = new tt.Popup({ offset: 20 }).setHTML(
                            '<div style="padding:8px;color:#0f172a;">' +
                            '<strong>' + c.name + '</strong><br>' +
                            'Population: ' + c.population + '<br>' +
                            'Urgency: <span style="color:' + color + ';font-weight:700;">' + (c.urgency || 0).toFixed(2) + '</span>' +
                            '</div>'
                        );

                        new tt.Marker({ element: el })
                            .setLngLat([c.x, c.y])
                            .setPopup(popup)
                            .addTo(map);
                    });
                });
        }

        if (document.getElementById('map')) {
            initCampMap();
        }
    </script>

    <script>
        // TomTom API key
        window.TOMTOM_KEY = "{{ tomtom_key|e }}";
    </script>
    <script src="/static/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
